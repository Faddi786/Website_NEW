<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Creation Page</title>
</head>
<body>
    <h1>Email Creation Page</h1>

    <form id="emailForm">

        <label for="from">From:</label>
        <input type="text" id="from" name="from" required>

        <label for="to">To : </label>
        <input type="text" id="to" name="to" required>

        <label for="cc">CC</label>
        <input type="text" id="cc" name="cc" required>

        <label for="bcc">BCC</label>
        <input type="text" id="bcc" name="bcc" required><br><br>

        <label for="date">Date:</label>
        <input type="text" id="date" name="date" required>

        <label for="purpose">Purpose:</label>
        <input type="text" id="purpose" name="purpose" required>

        <label for="approvalBy">Approval By:</label>
        <input type="text" id="approvalBy" name="approvalBy" required>

        <label for="amount">Amount:</label>
        <input type="text" id="amount" name="amount" required><br><br>

        <label for="project">Project:</label>
        <select id="project" name="project">
            <option value="Project A">Project A</option>
            <option value="Project B">Project B</option>
            <option value="Project C">Project C</option>
            <!-- Add more options as needed -->
        </select><br><br>

        <button onclick="addAttachment()">Drop Attachment</button>

        <div id="attachmentContainer">
            <!-- Dynamically created file input elements will be added here -->
        </div>

        <label for="body">Body:</label><br>
        <textarea id="body" name="body" rows="10" cols="100" required></textarea><br>

        <input type="button" value="Create Mail" onclick="createMail()"><br>

        <br>

        <label for="output">Output:</label><br>
        <textarea id="output" name="output" rows="5" cols="50" readonly></textarea><br>

        <input type="submit" value="Send" onclick="sendMail()">
    </form>

    <script>

function addAttachment() {
    var attachmentContainer = document.getElementById("attachmentContainer");

    var fileInput = document.createElement("input");
    fileInput.type = "file";
    fileInput.name = "attachments";
    fileInput.multiple = true;

    attachmentContainer.appendChild(fileInput);
    attachmentContainer.appendChild(document.createElement("br"));
}



    function createMail() {
    var purpose = document.getElementById("purpose").value;
    var project = document.getElementById("project").value;
    var approvalBy = document.getElementById("approvalBy").value;
    var amount = document.getElementById("amount").value;
    var from = document.getElementById("from").value;
    var name  = "Shaikh Fahad";
    var bodyTemplate = `Dear ${approvalBy},\n\nI hope this letter finds you well.  I am writing to request approval for an expense for ${purpose}, and I believe it is necessary for the successful completion of ${project}.\n\nThis expense has been approved by ${approvalBy}. The total amount needed for this expense is ${amount}. I assure you that I will handle this expense responsibly and in accordance with company policies and procedures.\n\nAdditionally, I will provide all necessary documentation and receipts for reimbursement promptly. Thank you for considering my request. I am available to discuss this further if you require any additional information.\n\nSincerely,\n${name}`;



    document.getElementById("body").value = bodyTemplate;
}



function sendMail() {
            var date = document.getElementById("date").value;
            var purpose = document.getElementById("purpose").value;
            var approvalBy = document.getElementById("approvalBy").value;
            var amount = document.getElementById("amount").value;
            var project = document.getElementById("project").value;
            var body = document.getElementById("body").value;


            var from = document.getElementById("from").value;
            var to = document.getElementById("to").value;
            var cc = document.getElementById("cc").value;
            var bcc = document.getElementById("bcc").value;
    
            var attachments = [];
    var attachmentInputs = document.getElementsByName('attachments');
    for (var i = 0; i < attachmentInputs.length; i++) {
        for (var j = 0; j < attachmentInputs[i].files.length; j++) {
            attachments.push(attachmentInputs[i].files[j]);
        }
    }
            var output = {
                date: date,
                purpose: purpose,
                approvalBy: approvalBy,
                amount: amount,
                project: project,
                body: body,
                from: from,
                to: to,
                cc: cc,
                bcc: bcc,
                attachments: attachments // Include attachments in the output object

            };
    
            // Send data to Flask function via AJAX
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/send_email", true);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.onreadystatechange = function() {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        var response = JSON.parse(xhr.responseText);
                        document.getElementById("output").value = response.message;
                    } else {
                        console.error('Error:', xhr.status);
                    }
                }
            };
            xhr.send(JSON.stringify(output));
        }

    </script>
    
</body>
</html>
