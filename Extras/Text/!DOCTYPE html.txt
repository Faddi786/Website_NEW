<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel Data</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Data from Excel</h1>
    <!-- Display the HTML table here -->
    <table id="editable-table">
        {{ table|safe }}
    </table>

    <button id="save-btn">Save</button>

    <script>
        $(document).ready(function() {
            // Convert table cells to dropdowns for editing (excluding specified columns)
            $('table tr:first-child td').each(function(index) {
                if ([1, 5, 6, 13, 15, 16, 17, 18].indexOf(index) === -1) { // Check if the column index is not in the exclusion list
                    var columnValues = [];
                    // Get all values from this column
                    $('table tr td:nth-child(' + (index + 1) + ')').each(function() {
                        var value = $(this).text().trim();
                        if (value !== '' && columnValues.indexOf(value) === -1) {
                            columnValues.push(value);
                        }
                    });
                    // Create dropdown with original cell value as default
                    var dropdown = '<select>';
                    for (var i = 0; i < columnValues.length; i++) {
                        dropdown += '<option value="' + columnValues[i] + '">' + columnValues[i] + '</option>';
                    }
                    dropdown += '</select>';
                    // Replace each cell in this column with the dropdown
                    $('table tr td:nth-child(' + (index + 1) + ')').each(function() {
                        var originalValue = $(this).text().trim();
                        $(this).html(dropdown).find('select').val(originalValue);
                    });
                }
            });

            // Event listener for delete buttons
            $('.delete-btn').click(function() {
                // Find the parent row and remove it
                $(this).closest('tr').remove();
            });

            // Event listener for save button
            $('#save-btn').click(function() {
                // Get the updated table data
                var updatedTable = $('table').prop('outerHTML');

                // Send the updated table data to Flask for saving
                $.ajax({
                    type: 'POST',
                    url: '/save',
                    data: {'table': updatedTable},
                    success: function(response) {
                        // Redirect to the main page after saving
                        window.location.href = '/ex';
                    },
                    error: function(error) {
                        console.error('Error saving data:', error);
                    }
                });
            });
        });
    </script>
</body>
</html>
