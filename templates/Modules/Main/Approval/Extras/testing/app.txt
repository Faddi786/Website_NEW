

app = Flask(__name__)
CORS(app)  # Enable CORS for all routes
@app.route('/')
def index():
    return render_template('bar.html')

def get_total_links():
    # Load the Excel workbook
    wb = openpyxl.load_workbook('Excel/handover_data.xlsx')
    
    # Access the sheet named 'Tom'
    sheet = wb['Tom']
    
    # Get the values from the 'Serial No' column
    serial_numbers = [cell.value for cell in sheet['G'] if cell.value is not None]
        
    # Extract the last number
    last_serial_number = serial_numbers[-1]
    
    # Extract the digit before the decimal point
    last_digit = int(str(last_serial_number).split('.')[0])
    print(last_digit)
    return last_digit

@app.route('/get_link_number')
def get_link_number():
    last_digit = get_total_links()
    print("This is the total number of digit without floating point",last_digit)
    return str(last_digit)


def extract_rows_from_excel(serial_number):
    excel_file = "Excel/handover_data.xlsx"  # Update with your Excel file path
    df = pd.read_excel(excel_file)
    # Convert "Serial No" column to strings
    df["Serial No"] = df["Serial No"].astype(str)
    filtered_df = df[df["Serial No"].str.startswith(str(serial_number) + ".")]
    return filtered_df.to_dict(orient="records")

# Load the Excel file
excel_file = "Excel/handover_data.xlsx"
df = pd.read_excel(excel_file)
extracted_rows = None



@app.route('/get_button_number', methods=['GET'])
def get_button_number():
    global extracted_rows
    button_number = int(request.args.get('button_number'))
    extracted_rows = extract_rows_from_excel(button_number)
    print("These are the extracted rowwwwwwwwwwwwwwwwwwwwwwwwwws",extracted_rows)
    return jsonify(extracted_rows)


@app.route('/get_form_data')
def get_form_data():
    global extracted_rows

    print("This is the rowwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww whatsasioadhwioe fhweuilbgy",extracted_rows)
    # Convert DataFrame to JSON string and return
    json_data = jsonify(extracted_rows)

    return json_data


@app.route('/form_data_display')
def form_data_display():
    return render_template('Modules/Main/Reciever/form_data.html', data=extracted_rows)



