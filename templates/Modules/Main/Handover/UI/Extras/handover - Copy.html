<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Handover Form</title>
<style>
  table {
    border-collapse: collapse;
    font-size: 10px !important;
  }
  th, td {
    border: 1px solid black;
    padding: 8px;
    text-align: left;
    font-size: 10px !important;
  }
  th {
    font-size: 10px !important;
    background-color: lightgray;
  }
</style>
</head>
<body>

<h2>Handover Form</h2>

<form id="handoverForm" enctype="multipart/form-data">

    
    <label for="originSite">Origin of Site:</label>
    <select id="originSite" name="originSite" required>
      <option value="">Select Origin Site</option>
      <option value="Site 1">Site 1</option>
      <option value="Site 2">Site 2</option>
      <option value="Site 3">Site 3</option>
      <!-- Add more options as needed -->
    </select><br><br>
  
    <label for="destinationSite">Destination Site:</label>
    <select id="destinationSite" name="destinationSite" required>
      <option value="">Select Destination Site</option>
      <option value="Site A">Site A</option>
      <option value="Site B">Site B</option>
      <option value="Site C">Site C</option>
      <!-- Add more options as needed -->
    </select><br><br>
  
    <label for="handoverPersonName">Handover Person Name:</label>
    <select id="handoverPersonName" name="handoverPersonName" required>
      <option value="">Select Handover Person</option>
      <option value="John Doe">John Doe</option>
      <option value="Jane Smith">Jane Smith</option>
      <option value="Alex Johnson">Alex Johnson</option>
      <!-- Add more options as needed -->
    </select><br><br>
  
    <label for="receiverPersonName">Receiver Person Name:</label>
    <select id="receiverPersonName" name="receiverPersonName" required>
      <option value="">Select Receiver Person</option>
      <option value="Michael Brown">Michael Brown</option>
      <option value="Emily Davis">Emily Davis</option>
      <option value="Chris Wilson">Chris Wilson</option>
      <!-- Add more options as needed -->
    </select><br><br>


    <label for="count">Enter Count:</label><br>
    <input type="number" id="count" name="count" min="1" value="1"><br><br>
  

  <table id="mainTable">
    <th>Serial No</th>
      <th>Product Name</th>
      <th>Product Make</th>
      <th>Model No</th> 
      <th>Product Serial</th>
      <th>Condition</th>
      <th>Check Boxes</th>
      
      <th>Remarks</th>

    <tr><td><label>1</label></td>
      <td>
        <select class="productCateogry" name="productCateogry">
          <option value="product1">Cat 1</option>
          <option value="product2">Cat 2</option>
          <option value="product3">Cat 3</option>
        </select>
      </td>
      
      <td>
        <select class="productMake" name="productMake">
          <option value="product1">Product 1</option>
          <option value="product2">Product 2</option>
          <option value="product3">Product 3</option>
        </select>
      </td>

      <td>
        <select class="productName" name="productName">
          <option value="product1">Product 1</option>
          <option value="product2">Product 2</option>
          <option value="product3">Product 3</option>
        </select>
      </td>

      <td>
        <select class="modelNo" name="modelNo">
          <option value="product1">Product 1</option>
          <option value="product2">Product 2</option>
          <option value="product3">Product 3</option>
        </select>
      </td>

      <td>
        <select class="Condition" name="Condition">
          <option value="Good">Good</option>
          <option value="Bad">Bad</option>
          <option value="Worse">Worse</option>
        </select>
      </td>
      <td>
        <input type="checkbox" name="reached"> Reached
        <input type="checkbox" name="frontend"> Frontend
        <input type="checkbox" name="backend"> Backend
        <input type="checkbox" name="cleanup"> Cleanup
    </td>

      <td><input type="text" class="remarks" name="remarks" size="40"></td>
    </tr>
  </table><br>
  <input type="button" value="Submit" id="submitButton">

</form>
<script>

  document.addEventListener("DOMContentLoaded", function() {
    var countInput = document.getElementById("count");
    var tableBody = document.querySelector("#mainTable tbody");
    var submitButton = document.getElementById("submitButton");

    countInput.addEventListener("input", function() {
        var count = parseInt(countInput.value);
        if (!isNaN(count)) {
            generateRows(count);
        }
    });


    submitButton.addEventListener("click", function() {
        logRowValues();
    });

    function generateRows(count) {
        // Clear existing body rows except the first one
        var bodyRows = tableBody.querySelectorAll('tr:not(:first-child)');
        bodyRows.forEach(function(row) {
            row.remove();
        });

        // Generate new rows
        for (var i = 0; i < count; i++) {
            var row = document.createElement("tr");
            row.innerHTML = `
            <td>
            <label for="serialNo_${i+1}">${i+1}</label>

        </td>

                <td>
                    <select class="productCategory" name="productCategory">
                        <option value="product1">Cat 1</option>
                        <option value="product2">Cat 2</option>
                        <option value="product3">Cat 3</option>
                    </select>
                </td>
                <td>
        <select class="productMake" name="productMake">
          <option value="product1">Product 1</option>
          <option value="product2">Product 2</option>
          <option value="product3">Product 3</option>
        </select>
      </td>

      <td>
        <select class="productName" name="productName">
          <option value="product1">Product 1</option>
          <option value="product2">Product 2</option>
          <option value="product3">Product 3</option>
        </select>
      </td>

      <td>
        <select class="modelNo" name="modelNo">
          <option value="product1">Product 1</option>
          <option value="product2">Product 2</option>
          <option value="product3">Product 3</option>
        </select>
      </td>
                <td>
                    <select class="Condition" name="Condition">
                        <option value="Good">Good</option>
                        <option value="Bad">Bad</option>
                        <option value="Worse">Worse</option>
                    </select>
                </td>
                <td>
    <input type="checkbox" name="reached"> Reached
    <input type="checkbox" name="frontend"> Frontend
    <input type="checkbox" name="backend"> Backend
    <input type="checkbox" name="cleanup"> Cleanup
</td>

                <td><input type="text" class="remarks" name="remarks" size="40"></td>
            `;
            tableBody.appendChild(row);
        }
    }

    function logRowValues() {
    var formObject = []; // Initialize formObject as an array

    // Object to store values from other form elements
    var otherFormValues = {
  
        originSite: document.getElementById("originSite").value,
        destinationSite: document.getElementById("destinationSite").value,
        handoverPersonName: document.getElementById("handoverPersonName").value,
        receiverPersonName: document.getElementById("receiverPersonName").value,
        count: parseInt(document.getElementById("count").value) // Parse count as integer
    };

    formObject.push(otherFormValues); // Append otherFormValues to formObject array

    // Loop through table rows and collect data
    var rows = tableBody.querySelectorAll('tr');
    rows.forEach(function(row, index) {
        if (index !== 0) { // Skip the header row
            var cells = row.querySelectorAll('td');
            var rowData = {
                productCategory: cells[1].querySelector('select').value,
                productName: cells[2].querySelector('select').value,
                condition: cells[3].querySelector('select').value,
                //remarks: cells[5].querySelector('input').value, // Remarks input field
                //reached: cells[4].querySelector('input[name="reached"]').checked, // Reached checkbox
                //frontend: cells[4].querySelector('input[name="frontend"]').checked, // Frontend checkbox
                //backend: cells[4].querySelector('input[name="backend"]').checked, // Backend checkbox
                //cleanup: cells[4].querySelector('input[name="cleanup"]').checked // Cleanup checkbox
            };
            formObject.push(rowData); // Append rowData to formObject array
            console.log(formObject)
        }
    });

    // Sending data to Flask server using a POST request
    var xhr = new XMLHttpRequest();
    xhr.open("POST", "http://127.0.0.1:5000/submit-form", true);

    xhr.onreadystatechange = function() {
        if (xhr.readyState === XMLHttpRequest.DONE) {
            if (xhr.status === 200) {
                var data = JSON.parse(xhr.responseText);
                // Handle response from server if needed
            } else {
                console.error('Error:', xhr.status);
            }
        }
    };

    xhr.setRequestHeader("Content-Type", "application/json"); // Set request header
    xhr.send(JSON.stringify(formObject));
}

});

</script>


</body>
</html>